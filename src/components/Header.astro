---
const { pathname } = Astro.url;
const currentPath = pathname.endsWith("/") ? pathname.slice(0, -1) : pathname;

const covers = import.meta.glob(
  "/src/content/portfolio/*/cover.{jpg,png,jpeg,webp}",
  { eager: true },
);
const collections = Object.keys(covers)
  .map((path) => {
    const parts = path.split("/");
    return parts[4];
  })
  .sort();

const styleCovers = import.meta.glob(
  "/src/content/portfolio/styles/*/cover.{jpg,png,jpeg,webp}",
  { eager: true },
);
const styleCollections = Object.keys(styleCovers)
  .map((path) => {
    const parts = path.split("/");
    return parts[5];
  })
  .sort();

const navItems = [
  { name: "HOME", href: "/" },
  {
    name: "PORTFOLIO",
    href: "/",
    dropdown: collections.map((c) => ({
      name: c,
      href: `/portfolio/${encodeURIComponent(c)}`,
    })),
  },
  {
    name: "STYLES",
    href: "/styles",
    dropdown: styleCollections.map((c) => ({
      name: c,
      href: `/portfolio/${encodeURIComponent(c)}`,
    })),
  },
  { name: "BIO", href: "/bio" },
];

interface Props {
  heroImage?: ImageMetadata;
}

const { heroImage } = Astro.props;
---

{
  heroImage ? (
    /* HERO HEADER VARIANT */
    <header class="w-full relative h-[85vh] min-h-[600px] mb-12 flex flex-col text-white">
      {/* Background Image */}
      <div class="absolute inset-0 z-0">
        <img
          src={heroImage.src}
          alt="Hero Background"
          class="w-full h-full object-cover"
        />
        <div class="absolute inset-0 bg-black/20" />{" "}
        {/* Subtle overlay for text readability */}
      </div>

      {/* Top Nav Bar (Transparent) */}
      <div class="relative z-20 w-full max-w-7xl mx-auto px-6 md:px-12 pt-6 md:pt-8 flex justify-end">
        <nav>
          <ul class="flex items-center gap-8">
            {navItems.map((item) => (
              <li class="relative group nav-item">
                <div class="flex items-center gap-1">
                  <a
                    href={item.href}
                    class:list={[
                      "text-sm font-medium uppercase tracking-widest transition-colors cursor-pointer",
                      currentPath === item.href
                        ? "border-b border-white pb-1"
                        : "text-white/90 hover:text-white",
                    ]}
                  >
                    {item.name}
                  </a>
                  {item.dropdown && (
                    <button
                      class="dropdown-trigger p-1 focus:outline-none"
                      aria-label="Toggle Dropdown"
                    >
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-3 w-3 opacity-70 transition-transform duration-200 group-[.open]:rotate-180"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M19 9l-7 7-7-7"
                        />
                      </svg>
                    </button>
                  )}
                </div>

                {/* Dropdown (Darker for Hero?) or White? keeping white for consistency, handling text color */}
                {item.dropdown && (
                  <div class="absolute top-full left-1/2 -translate-x-1/2 pt-2 opacity-0 invisible group-hover:opacity-100 group-hover:visible group-[.open]:opacity-100 group-[.open]:visible transition-all duration-200 min-w-[200px]">
                    <div class="bg-white border text-center border-gray-100 shadow-xl rounded-sm py-2 px-1">
                      {item.dropdown.map((subItem) => (
                        <a
                          href={subItem.href}
                          class="block px-4 py-3 text-xs text-gray-500 hover:text-black hover:bg-gray-50 uppercase tracking-wider transition-colors"
                        >
                          {subItem.name}
                        </a>
                      ))}
                    </div>
                  </div>
                )}
              </li>
            ))}
          </ul>
        </nav>
      </div>

      {/* Center Branding */}
      <div class="relative z-10 flex-grow flex items-center justify-center">
        <h1 class="text-4xl md:text-6xl lg:text-7xl font-bold uppercase tracking-[0.25em] text-white text-center drop-shadow-md">
          Leo Wuellner
        </h1>
      </div>
    </header>
  ) : (
    /* STANDARD HEADER VARIANT */
    <header class="w-full bg-white py-6 md:py-8 mb-8 md:mb-12 relative z-50">
      <div class="max-w-7xl mx-auto px-6 md:px-12 flex flex-col md:flex-row justify-between items-center gap-4">
        <div class="logo">
          <a
            href="/"
            class="text-2xl font-bold uppercase tracking-[0.2em] text-black hover:opacity-70 transition-opacity"
          >
            Leo Wuellner
          </a>
        </div>

        <nav>
          <ul class="flex items-center gap-8">
            {navItems.map((item) => (
              <li class="relative group nav-item">
                <div class="flex items-center gap-1">
                  <a
                    href={item.href}
                    class:list={[
                      "text-sm font-medium uppercase tracking-widest transition-colors cursor-pointer",
                      currentPath === item.href
                        ? "text-black border-b border-black pb-1"
                        : "text-gray-500 hover:text-black",
                    ]}
                  >
                    {item.name}
                  </a>
                  {item.dropdown && (
                    <button
                      class="dropdown-trigger p-1 focus:outline-none"
                      aria-label="Toggle Dropdown"
                    >
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-3 w-3 opacity-50 transition-transform duration-200 group-[.open]:rotate-180"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M19 9l-7 7-7-7"
                        />
                      </svg>
                    </button>
                  )}
                </div>

                {item.dropdown && (
                  <div class="absolute top-full left-1/2 -translate-x-1/2 pt-2 opacity-0 invisible group-hover:opacity-100 group-hover:visible group-[.open]:opacity-100 group-[.open]:visible transition-all duration-200 min-w-[200px]">
                    <div class="bg-white border text-center border-gray-100 shadow-xl rounded-sm py-2 px-1">
                      {item.dropdown.map((subItem) => (
                        <a
                          href={subItem.href}
                          class="block px-4 py-3 text-xs text-gray-500 hover:text-black hover:bg-gray-50 uppercase tracking-wider transition-colors"
                        >
                          {subItem.name}
                        </a>
                      ))}
                    </div>
                  </div>
                )}
              </li>
            ))}
          </ul>
        </nav>
      </div>
    </header>
  )
}

<script>
  // Handle Dropdown Toggles
  document.addEventListener("DOMContentLoaded", () => {
    const dropdownTriggers = document.querySelectorAll(".dropdown-trigger");

    dropdownTriggers.forEach((trigger) => {
      trigger.addEventListener("click", (e) => {
        // Prevent default navigation for dropdown triggers
        e.preventDefault();

        // Toggle 'open' class on the parent list item
        const parent = trigger.closest(".nav-item");
        if (parent) {
          parent.classList.toggle("open");
        }
      });
    });

    // Close dropdowns when clicking outside
    document.addEventListener("click", (e) => {
      if (!(e.target as Element).closest(".nav-item")) {
        document.querySelectorAll(".nav-item.open").forEach((item) => {
          item.classList.remove("open");
        });
      }
    });
  });
</script>
